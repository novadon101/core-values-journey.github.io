<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Core Values Journey</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Great+Vibes&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    :root {
      --primary-bg: #FFF9EC; --heading-color: #2c2c4e; --text-color: #4a4a68; --accent-blue: #aee2ff; --accent-peach: #ffd6a5; --selection-green: #28a745; --removal-red: #dc3545; --card-bg: #ffffff; --overlay-bg: rgba(255, 249, 236, 0.85); --shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
    }
    html, body { margin: 0; padding: 0; width: 100%; height: 100%; font-family: 'Poppins', sans-serif; background-color: var(--primary-bg); color: var(--text-color); overflow: hidden; }
    .page { display: none; position: absolute; inset: 0; background-size: cover; background-position: center; animation: fadeIn 1s ease-in-out; }
    .page.active { display: block; }
    .overlay { position: absolute; inset: 0; background: var(--overlay-bg); display: flex; flex-direction: column; justify-content: flex-start; align-items: center; text-align: center; padding: 5vh 20px; overflow-y: auto; box-sizing: border-box; }
    h1, h2 { color: var(--heading-color); font-weight: 700; margin: 0 0 10px 0; }
    h1 { font-size: 2.4rem; }
    h2 { font-size: 1.7rem; }
    h2 .user-name-display { color: inherit; text-decoration: none; }
    p { font-size: 1.1rem; line-height: 1.7; max-width: 650px; margin: 0 auto 15px auto; }
    .page-content { max-width: 1300px; width: 100%; display: flex; flex-direction: column; align-items: center; }
    .counter { background-color: rgba(255, 255, 255, 0.8); color: var(--heading-color); padding: 5px 20px; border-radius: 50px; font-weight: 600; font-size: 1.1rem; margin-bottom: 15px; display: inline-block; box-shadow: 0 2px 10px rgba(0,0,0,0.07); }
    .value-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 8px; width: 95%; max-width: 1200px; margin: 15px 0; }
    .value-card { background-color: var(--card-bg); border: 1px solid #e0e0e0; border-radius: 8px; padding: 8px 5px; font-size: 0.8rem; font-weight: 600; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease; display: flex; justify-content: center; align-items: center; min-height: 36px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .value-card:hover { transform: translateY(-3px); box-shadow: 0 6px 15px rgba(0,0,0,0.1); }
    .value-card.selected-green { background-color: var(--selection-green); color: white; border-color: var(--selection-green); }
    .value-card.selected-red { background-color: var(--removal-red); color: white; border-color: var(--removal-red); }
    .button-group { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 20px; }
    button { background: linear-gradient(90deg, var(--accent-blue), var(--accent-peach)); color: var(--heading-color); border: none; padding: 14px 35px; border-radius: 50px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
    .name-input-container { display: flex; flex-direction: column; gap: 10px; width: 90%; max-width: 500px; margin-bottom: 5px; align-items: center; }
    .name-input { font-family: 'Poppins', sans-serif; font-size: 1.1rem; padding: 12px 20px; border-radius: 50px; border: 2px solid #ccc; width: 100%; text-align: center; transition: border-color 0.3s; box-sizing: border-box; }
    .name-input.input-error { border-color: var(--removal-red); }
    .error-message { color: var(--removal-red); font-size: 0.9rem; font-weight: 600; height: 1.2em; }
    .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); animation: fadeIn 0.5s; }
    .modal-content { background-color: white; margin: 15% auto; padding: 30px; border-radius: 15px; max-width: 500px; text-align: center; box-shadow: var(--shadow); }
    #modal-title { margin-bottom: 10px; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    
    #certificate { padding: 10px; border-radius: 15px; background: var(--accent-blue); margin-top: 20px; max-width: 750px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
    .cert-border { border: 2px solid #fff; background: linear-gradient(135deg, #f5f7fa, #eef2f7); padding: 30px; border-radius: 10px; }
    .cert-header { text-align: center; }
    .cert-compass-icon { width: 40px; height: 40px; margin-bottom: 10px; fill: var(--heading-color); opacity: 0.7; }
    .cert-title { font-size: 1.1rem; color: var(--text-color); text-transform: uppercase; letter-spacing: 2px; }
    .cert-name { font-size: 2.2rem; color: var(--heading-color); margin: 10px 0; }
    .cert-message { font-size: 1rem; line-height: 1.6; margin: 15px 0; }
    .cert-values-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 25px 0; }
    .cert-value { background-color: #fff; padding: 15px; border-radius: 10px; font-size: 1.2rem; font-weight: 600; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    .cert-signature { font-family: 'Great Vibes', cursive; font-size: 2.8rem; color: #333; margin: 25px 0 15px 0; }
    .cert-footer { border-top: 1px solid #ddd; padding-top: 15px; margin-top: 20px; }
    #cert-quote { font-style: italic; font-size: 1rem; line-height: 1.5; padding: 0 10px; }
    #cert-date { font-size: 0.9rem; color: #777; margin-top: 15px; }

    @media print {
      body.is-printing > *:not(.print-container) { display: none !important; }
      body.is-printing .print-container { display: block !important; }
      .print-container { display: none; position: absolute; top: 0; left: 0; width: 100%; }
    }
    @media (max-width: 600px) {
      h1 { font-size: 2rem; } h2 { font-size: 1.5rem; } p { font-size: 1rem; }
      .name-input-container { flex-direction: column; }
      .cert-border { padding: 20px; } .cert-name { font-size: 1.8rem; }
      .cert-values-grid { grid-template-columns: 1fr; gap: 10px; }
      .cert-value { font-size: 1.1rem; padding: 12px; } .cert-signature { font-size: 2.2rem; } #cert-quote { font-size: 0.9rem; }
    }
  </style>
</head>
<body>

  <div id="page-language" class="page active">
    <div class="overlay">
        <div class="page-content">
            <h1 data-translate-key="lang_title">Choose Your Language</h1>
            <p data-translate-key="lang_subtitle" style="font-size: 1.2rem;">Elige Tu Idioma</p>
            <div class="button-group">
                <button onclick="selectLanguage('en')">English</button>
                <button onclick="selectLanguage('es')">Espa√±ol</button>
            </div>
        </div>
    </div>
  </div>

  <div id="page-welcome" class="page" style="background-image: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=2070&v=1');">
    <div class="overlay"><div class="page-content"><h1 data-translate-key="welcome_title"></h1><p data-translate-key="welcome_p1"></p><div class="name-input-container"><input type="text" id="first-name-input" class="name-input"><input type="text" id="last-name-input" class="name-input"></div><p id="name-error" class="error-message"></p><button onclick="startJourney()" data-translate-key="btn_begin"></button></div></div>
  </div>
  
  <div id="page-select-15" class="page" style="background-image: url('https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=2070&v=1');">
    <div class="overlay top-aligned-overlay"><div class="page-content"><h2><span data-translate-key="step1_h2_p1"></span><span class="user-name-display"></span><span data-translate-key="step1_h2_p2"></span></h2><p data-translate-key="step1_p"></p><div id="counter-step1" class="counter"></div><div id="grid-select-15" class="value-grid"></div></div></div>
  </div>

  <div id="page-remove-5-from-15" class="page" style="background-image: url('https://images.unsplash.com/photo-1454496522488-7a8e488e8606?auto=format&fit=crop&w=2076&v=1');">
      <div class="overlay top-aligned-overlay"><div class="page-content"><h2><span data-translate-key="step2_h2_p1"></span><span class="user-name-display"></span><span data-translate-key="step2_h2_p2"></span></h2><p data-translate-key="step2_p"></p><div id="counter-step2" class="counter"></div><div id="grid-remove-5-from-15" class="value-grid"></div><div class="button-group"><button onclick="goBackToStep1()" data-translate-key="btn_back"></button></div></div></div>
  </div>

  <div id="page-remove-5-from-10" class="page" style="background-image: url('https://images.unsplash.com/photo-1470770841072-f978cf4d019e?auto=format&fit=crop&w=2070&v=1');">
    <div class="overlay top-aligned-overlay"><div class="page-content"><h2><span data-translate-key="step3_h2_p1"></span><span class="user-name-display"></span><span data-translate-key="step3_h2_p2"></span></h2><p data-translate-key="step3_p"></p><div id="counter-step3" class="counter"></div><div id="grid-remove-5-from-10" class="value-grid"></div><div class="button-group"><button onclick="goBackToStep2()" data-translate-key="btn_back"></button></div></div></div>
  </div>

  <div id="page-remove-2-from-5" class="page" style="background-image: url('https://images.unsplash.com/photo-1549880338-65ddcdfd017b?auto=format&fit=crop&w=2070&v=1');">
    <div class="overlay top-aligned-overlay"><div class="page-content"><h2><span data-translate-key="step4_h2_p1"></span><span class="user-name-display"></span><span data-translate-key="step4_h2_p2"></span></h2><p data-translate-key="step4_p"></p><div id="counter-step4" class="counter"></div><div id="grid-remove-2-from-5" class="value-grid"></div><div class="button-group"><button onclick="goBackToStep3()" data-translate-key="btn_back"></button></div></div></div>
  </div>
  
  <div id="page-final" class="page" style="background-image: url('https://images.unsplash.com/photo-1494500764479-0c8f2919a3d8?auto=format&fit=crop&w=2070&v=1');">
    <div class="overlay top-aligned-overlay">
        <div id="certificate-wrapper" class="page-content">
            <h1 data-translate-key="final_title"></h1>
            <p><span data-translate-key="final_p1"></span><span class="user-name-display"></span><span data-translate-key="final_p2"></span></p>
            <div id="certificate">
                <div class="cert-border">
                    <div class="cert-header">
                        <svg class="cert-compass-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd"><path d="M12 0c-6.623 0-12 5.377-12 12s5.377 12 12 12 12-5.377 12-12-5.377-12-12-12zm0 1c-6.071 0-11 4.929-11 11s4.929 11 11 11 11-4.929 11-11-4.929-11-11-11zm5 7.75l-5.021 10.25-5-10.25h10.021zm-5 1.579l3.018 6.171-3.018-1.575-3.018 1.575 3.018-6.171zm0-5.329l-3.018 6.171 3.018-1.575 3.018 1.575-3.018-6.171z"/></svg>
                        <div class="cert-title" data-translate-key="cert_title"></div>
                        <h2 id="cert-name" class="cert-name"></h2>
                    </div>
                    <p class="cert-message" data-translate-key="cert_message"></p>
                    <div id="cert-values-grid" class="cert-values-grid"></div>
                    <div id="cert-signature" class="cert-signature"></div>
                    <div class="cert-footer">
                        <p id="cert-quote"></p>
                        <p id="cert-date"></p>
                    </div>
                </div>
            </div>
            <div class="button-group">
                <button onclick="downloadAsPDF()" data-translate-key="btn_pdf"></button>
            </div>
            <button onclick="restartJourney()" style="margin-top: 20px;" data-translate-key="btn_restart"></button>
        </div>
    </div>
  </div>

  <div id="confirmation-modal" class="modal">
    <div class="modal-content">
      <h2 id="modal-title"></h2><p id="modal-text"></p>
      <div class="button-group" style="justify-content: center;">
        <button id="modal-btn-back" data-translate-key="btn_modal_back"></button>
        <button id="modal-btn-confirm" data-translate-key="btn_modal_continue"></button>
      </div>
    </div>
  </div>

  <script>
    const translations = {
      en: {
        allValues: [ 'Acceptance', 'Accountability', 'Achievement', 'Ambition', 'Appreciation', 'Authenticity', 'Balance', 'Bravery', 'Calmness', 'Charity', 'Commitment', 'Community', 'Compassion', 'Confidence', 'Connection', 'Consistency', 'Contentment', 'Contribution', 'Cooperation', 'Courage', 'Creativity', 'Curiosity', 'Diligence', 'Discipline', 'Empathy', 'Encouragement', 'Equality', 'Excellence', 'Fairness', 'Faith', 'Family', 'Flexibility', 'Forgiveness', 'Freedom', 'Friendship', 'Generosity', 'Giving', 'Gratitude', 'Growth', 'Happiness', 'Harmony', 'Health', 'Honesty', 'Hope', 'Humility', 'Humor', 'Inclusion', 'Independence', 'Influence', 'Innovation', 'Integrity', 'Joy', 'Justice', 'Kindness', 'Knowledge', 'Leadership', 'Learning', 'Love', 'Loyalty', 'Open-mindedness', 'Optimism', 'Patience', 'Perseverance', 'Resilience', 'Responsibility', 'Self-Respect' ],
        lang_title: "Choose Your Language", lang_subtitle: "Elige Tu Idioma",
        welcome_title: "Welcome to Your Core Values Journey",
        welcome_p1: "This is a quiet moment to reconnect with what truly guides you. To begin, please enter your name below.",
        placeholder_first_name: "First Name", placeholder_last_name: "Last Name",
        error_name: "Please enter both your first and last name.",
        btn_begin: "Begin My Journey",
        step1_h2_p1: "Let's begin, ", step1_h2_p2: ". Here is your first step.",
        step1_p: "Explore the values below and select up to 15 that resonate with you. These can be values that represent you today or qualities you want to cultivate in the future. Let yourself be guided by what you feel, more than what you think.",
        counter_selected: "Selected",
        step2_h2_p1: "Alright ", step2_h2_p2: ". Let‚Äôs focus a bit more.",
        step2_p: "From the values you chose, pick five that you can set aside for now. This step will help you discover which ones are most essential to you.",
        counter_removed: "Removed",
        step3_h2_p1: "Great work, ", step3_h2_p2: ". Now refine to 5.",
        step3_p: "This can be challenging, but it brings great clarity. From your remaining values, select 5 more to set aside.",
        step4_h2_p1: "This is the final step, ", step4_h2_p2: "!",
        step4_p: "From your final 5 values, choose 2 that you could set aside. The ones that remain will reflect what truly guides you.",
        final_title: "Your Journey is Complete!",
        final_p1: "Congratulations, ", final_p2: "! Here is your personal certificate of core values.",
        cert_title: "A Certificate of Core Values",
        cert_message: "These three values represent your authentic compass. Let them guide you with clarity and purpose in all that you do.",
        cert_quote: "‚ÄúA highly-developed values system is like a compass. It serves as a guide to point you in the right direction when you are lost.‚Äù ‚Äì Idowu Koyenikan",
        cert_completed: "Completed on",
        btn_pdf: "Download PDF", btn_restart: "Start a New Journey", btn_back: "Back",
        modal_title_confirm15: "You've selected 15 values!", modal_text_confirm15: "Are you ready to move on and refine your selection?",
        modal_title_confirm_removal: "Ready to Continue?", modal_text_confirm_removal: "This will lock in your choices for this step. Are you sure?",
        btn_modal_back: "Go Back", btn_modal_continue: "Continue"
      },
      es: {
        allValues: [ 'Aceptaci√≥n', 'Agradecimiento', 'Alegr√≠a', 'Amabilidad', 'Ambici√≥n', 'Amistad', 'Amor', 'Aprendizaje', 'Apertura Mental', 'Armon√≠a', 'Autoestima', 'Autenticidad', 'Calma', 'Colaboraci√≥n', 'Comunidad', 'Compasi√≥n', 'Compromiso', 'Confianza', 'Conexi√≥n', 'Coherencia', 'Contribuci√≥n', 'Coraje', 'Creatividad', 'Crecimiento', 'Curiosidad', 'Dar', 'Dedicaci√≥n', 'Disciplina', 'Empat√≠a', 'Equidad', 'Equilibrio', 'Esperanza', 'Excelencia', 'Familia', 'Fe', 'Felicidad', 'Flexibilidad', 'Generosidad', 'Gratitud', 'Honestidad', 'Humildad', 'Humor', 'Igualdad', 'Inclusi√≥n', 'Independencia', 'Influencia', 'Innovaci√≥n', 'Integridad', 'Justicia', 'Lealtad', 'Liderazgo', 'Libertad', 'Logro', 'Motivaci√≥n', 'Optimismo', 'Paciencia', 'Perd√≥n', 'Perseverancia', 'Plenitud', 'Resiliencia', 'Responsabilidad', 'Sabidur√≠a', 'Salud', 'Solidaridad', 'Valent√≠a' ],
        lang_title: "Elige Tu Idioma", lang_subtitle: "Choose Your Language",
        welcome_title: "Bienvenido a Tu Exploraci√≥n de Valores Esenciales",
        welcome_p1: "T√≥mate un momento para reconectarte con lo que realmente te gu√≠a. Para comenzar, por favor ingresa tu nombre.",
        placeholder_first_name: "Nombre", placeholder_last_name: "Apellido",
        error_name: "Por favor, ingresa tu nombre y apellido para comenzar.",
        btn_begin: "Empieza mi recorrido de valores",
        step1_h2_p1: "Empecemos, ", step1_h2_p2: ". Este es tu primer paso.",
        step1_p: "Explora los valores de la lista de abajo y elige hasta 15 que resuenen contigo. Pueden ser valores que te representen hoy o cualidades que quieras cultivar en el futuro. D√©jate guiar por lo que sientas m√°s que por lo que pienses.",
        counter_selected: "Seleccionados",
        step2_h2_p1: "Muy bien, ", step2_h2_p2: ". Vamos a enfocarnos un poco m√°s.",
        step2_p: "De los valores que elegiste, elige cinco que puedas dejar en segundo plano por ahora. Este paso te ayudar√° a descubrir cu√°les son los m√°s esenciales para ti.",
        counter_removed: "Eliminados",
        step3_h2_p1: "Buen trabajo, ", step3_h2_p2: ". Ahora reduce a 5.",
        step3_p: "Esto puede ser un desaf√≠o, pero trae una gran claridad. De los valores que te quedan, selecciona 5 m√°s para dejar a un lado.",
        step4_h2_p1: "¬°Este es el √∫ltimo paso, ", step4_h2_p2: "!",
        step4_p: "De tus 5 valores finales, elige 2 que podr√≠as dejar a un lado. Los que queden reflejar√°n lo que de verdad te gu√≠a.",
        final_title: "¬°Tu recorrido de valores ha terminado!",
        final_p1: "Felicidades, ", final_p2: "! Aqu√≠ tienes tu certificado personal de valores fundamentales.",
        cert_title: "Un Certificado de Valores Fundamentales",
        cert_message: "Felicidades, has completado tu recorrido de valores personales.",
        cert_quote: "‚ÄúUn sistema de valores altamente desarrollado es como una br√∫jula. Sirve como una gu√≠a para se√±alarte la direcci√≥n correcta cuando est√°s perdido.‚Äù ‚Äì Idowu Koyenikan",
        cert_completed: "Completado el",
        btn_pdf: "Descargar PDF", btn_restart: "Comenzar un nuevo recorrido de valores", btn_back: "Atr√°s",
        modal_title_confirm15: "¬°Has seleccionado 15 valores!", modal_text_confirm15: "¬øEst√°s listo para continuar y refinar tu selecci√≥n?",
        modal_title_confirm_removal: "¬øListo para Continuar?", modal_text_confirm_removal: "Esto guardar√° tus elecciones para este paso. ¬øEst√°s seguro?",
        btn_modal_back: "Regresar", btn_modal_continue: "Continuar"
      }
    };
    let state = { language: 'en', firstName: '', lastName: '', initialSelection: new Set(), phase2_15: [], phase3_10: [], phase4_5: [], final_3: [], removalSelection: new Set() };
    const modal = document.getElementById('confirmation-modal'); const modalTitle = document.getElementById('modal-title'); const modalText = document.getElementById('modal-text'); const modalConfirmBtn = document.getElementById('modal-btn-confirm');
    
    function showPage(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        const page = document.getElementById(pageId);
        if (page) { page.classList.add('active'); }
    }
    
    function translateUI() {
        const lang = state.language;
        document.querySelectorAll('[data-translate-key]').forEach(el => {
            const key = el.dataset.translateKey;
            if(translations[lang][key]) { el.textContent = translations[lang][key]; }
        });
        document.getElementById('first-name-input').placeholder = translations[lang].placeholder_first_name;
        document.getElementById('last-name-input').placeholder = translations[lang].placeholder_last_name;
    }

    function selectLanguage(lang) {
        state.language = lang;
        translateUI();
        showPage('page-welcome');
    }

    function startJourney() {
        const firstNameInput = document.getElementById('first-name-input');
        const lastNameInput = document.getElementById('last-name-input');
        const nameError = document.getElementById('name-error');
        firstNameInput.classList.remove('input-error'); lastNameInput.classList.remove('input-error');
        const firstName = firstNameInput.value.trim();
        const lastName = lastNameInput.value.trim();
        let hasError = false;
        if (firstName === '') { firstNameInput.classList.add('input-error'); hasError = true; }
        if (lastName === '') { lastNameInput.classList.add('input-error'); hasError = true; }
        if (hasError) { nameError.textContent = translations[state.language].error_name; return; }
        nameError.textContent = '';
        state.firstName = firstName;
        state.lastName = lastName;
        document.querySelectorAll('.user-name-display').forEach(span => span.textContent = state.firstName);
        populateGrid('grid-select-15', translations[state.language].allValues, state.initialSelection); 
        updateCounter('counter-step1', state.initialSelection.size, 15, 'counter_selected'); 
        showPage('page-select-15');
    }
    function restartJourney() { state = { language: 'en', firstName: '', lastName: '', initialSelection: new Set(), phase2_15: [], phase3_10: [], phase4_5: [], final_3: [], removalSelection: new Set() }; document.getElementById('first-name-input').value = ''; document.getElementById('last-name-input').value = ''; showPage('page-language'); }
    function goBackToStep1() { showPage('page-select-15'); }
    function goBackToStep2() { state.removalSelection.clear(); populateGrid('grid-remove-5-from-15', state.phase2_15, new Set()); updateCounter('counter-step2', 0, 5, 'counter_removed'); showPage('page-remove-5-from-15'); }
    function goBackToStep3() { state.removalSelection.clear(); populateGrid('grid-remove-5-from-10', state.phase3_10, new Set()); updateCounter('counter-step3', 0, 5, 'counter_removed'); showPage('page-remove-5-from-10'); }
    function showConfirmationModal(titleKey, textKey, confirmAction) { modalTitle.textContent = translations[state.language][titleKey]; modalText.textContent = translations[state.language][textKey]; modalConfirmBtn.onclick = () => { closeModal(); confirmAction(); }; document.getElementById('modal-btn-back').onclick = closeModal; modal.style.display = 'block'; }
    function closeModal() { modal.style.display = 'none'; }
    function updateCounter(counterId, current, total, actionKey) { const el = document.getElementById(counterId); if (el) el.textContent = `${current} / ${total} ${translations[state.language][actionKey]}`; }
    function populateGrid(gridId, values, selectionSet) {
        const grid = document.getElementById(gridId); grid.innerHTML = ''; const isRemoval = gridId.startsWith('grid-remove');
        values.forEach(value => {
            const card = document.createElement('div'); card.className = 'value-card'; card.textContent = value; card.dataset.value = value;
            if (selectionSet.has(value)) card.classList.add(isRemoval ? 'selected-red' : 'selected-green');
            card.addEventListener('click', () => {
                if (gridId === 'grid-select-15') handleInitialSelection(card, 15);
                else if (gridId === 'grid-remove-5-from-15') handleRemovalSelection(card, 5, 'step2');
                else if (gridId === 'grid-remove-5-from-10') handleRemovalSelection(card, 5, 'step3');
                else if (gridId === 'grid-remove-2-from-5') handleRemovalSelection(card, 2, 'step4');
            });
            grid.appendChild(card);
        });
    }
    function handleInitialSelection(card, limit) {
        const value = card.dataset.value;
        if (state.initialSelection.has(value)) { state.initialSelection.delete(value); card.classList.remove('selected-green'); } 
        else if (state.initialSelection.size < limit) { state.initialSelection.add(value); card.classList.add('selected-green'); }
        updateCounter('counter-step1', state.initialSelection.size, 15, 'counter_selected');
        if (state.initialSelection.size === limit) {
            showConfirmationModal('modal_title_confirm15', 'modal_text_confirm15',
                () => { state.phase2_15 = Array.from(state.initialSelection).sort(); state.removalSelection.clear(); populateGrid('grid-remove-5-from-15', state.phase2_15, state.removalSelection); updateCounter('counter-step2', 0, 5, 'counter_removed'); showPage('page-remove-5-from-15'); }
            );
        }
    }
    function handleRemovalSelection(card, limit, step) {
        const value = card.dataset.value;
        if (state.removalSelection.has(value)) { state.removalSelection.delete(value); card.classList.remove('selected-red'); } 
        else if (state.removalSelection.size < limit) { state.removalSelection.add(value); card.classList.add('selected-red'); }
        let nextAction;
        if (step === 'step2') {
            updateCounter('counter-step2', state.removalSelection.size, 5, 'counter_removed');
            nextAction = () => { state.phase3_10 = state.phase2_15.filter(v => !state.removalSelection.has(v)).sort(); state.removalSelection.clear(); populateGrid('grid-remove-5-from-10', state.phase3_10, state.removalSelection); updateCounter('counter-step3', 0, 5, 'counter_removed'); showPage('page-remove-5-from-10'); };
        } else if (step === 'step3') {
            updateCounter('counter-step3', state.removalSelection.size, 5, 'counter_removed');
            nextAction = () => { state.phase4_5 = state.phase3_10.filter(v => !state.removalSelection.has(v)).sort(); state.removalSelection.clear(); populateGrid('grid-remove-2-from-5', state.phase4_5, state.removalSelection); updateCounter('counter-step4', 0, 2, 'counter_removed'); showPage('page-remove-2-from-5'); };
        } else if (step === 'step4') {
            updateCounter('counter-step4', state.removalSelection.size, 2, 'counter_removed');
            nextAction = () => { state.final_3 = state.phase4_5.filter(v => !state.removalSelection.has(v)).sort(); populateCertificate(state.final_3); showPage('page-final'); };
        }
        if (state.removalSelection.size === limit) { showConfirmationModal('modal_title_confirm_removal','modal_text_confirm_removal', nextAction); }
    }
    function populateCertificate(values) {
        const fullName = `${state.firstName} ${state.lastName}`.trim();
        document.getElementById('cert-name').textContent = fullName;
        document.getElementById('cert-signature').textContent = fullName;
        const today = new Date();
        const dateString = today.toLocaleDateString(state.language === 'es' ? 'es-ES' : 'en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        document.getElementById('cert-date').textContent = `${translations[state.language].cert_completed} ${dateString}`;
        const valuesContainer = document.getElementById('cert-values-grid');
        valuesContainer.innerHTML = '';
        values.forEach(v => { const div = document.createElement('div'); div.className = 'cert-value'; div.textContent = v; valuesContainer.appendChild(div); });
        document.getElementById('cert-quote').textContent = translations[state.language].cert_quote;
    }
    function downloadAsPDF() {
        const certificate = document.getElementById("certificate");
        const fullName = `${state.firstName} ${state.lastName}`.trim();
        const { jsPDF } = window.jspdf;
        html2canvas(certificate, { scale: 3, useCORS: true }).then(canvas => {
            const imgData = canvas.toDataURL('image/png');
            const pdf = new jsPDF({ orientation: 'landscape', unit: 'pt', format: 'a4' });
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const pdfHeight = pdf.internal.pageSize.getHeight();
            const canvasWidth = canvas.width;
            const canvasHeight = canvas.height;
            const ratio = Math.min((pdfWidth - 40) / canvasWidth, (pdfHeight - 40) / canvasHeight);
            const scaledWidth = canvasWidth * ratio;
            const scaledHeight = canvasHeight * ratio;
            const x = (pdfWidth - scaledWidth) / 2;
            const y = (pdfHeight - scaledHeight) / 2;
            pdf.addImage(imgData, 'PNG', x, y, scaledWidth, scaledHeight);
            pdf.save(`${fullName}-Core-Values.pdf`);
        });
    }
    document.addEventListener('DOMContentLoaded', restartJourney);
    document.addEventListener('keydown', (event) => {
      if (modal.style.display === 'block') {
        if (event.key === 'Escape') {
          closeModal();
        } else if (event.key === 'Enter') {
          modalConfirmBtn.click();
        }
      }
    });
  </script>
</body>
</html></html>